<!doctype html>
<html lang="en">

<head>
    <!-- Google Consent Mode -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied'
        });
    </script>
    <!-- End Google Consent Mode -->

    <!-- Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-56G5F5W4');
    </script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./favicon-CNYHsM1K.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gomoku</title>


    <meta name="description" content="Gomoku - Classic strategy board game. Place 5 stones in a row to win!" />
    <meta name="keywords" content="Gomoku, Five in a Row, board game, strategy, game" />
    <meta name="author" content="Tran Hai Dang" />
    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="Gomoku" />
    <meta property="og:description" content="Gomoku - Classic strategy board game. Place 5 stones in a row to win!" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tiniquiz.com/gomoku/" />
    <meta property="og:image" content="https://tiniquiz.com/gomoku/favicon.svg" />
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Gomoku" />
    <meta name="twitter:description" content="Gomoku - Classic strategy board game. Place 5 stones in a row to win!" />
    <meta name="twitter:image" content="https://tiniquiz.com/gomoku/favicon.svg" />
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=e(i);fetch(i.href,l)}})();class E{boardSize;constructor(t=15){this.boardSize=t}setBoardSize(t){this.boardSize=t}getBestMove(t,e){const n=e==="BLACK"?"WHITE":"BLACK",i=this.findWinningMove(t,e);if(i)return i;const l=this.findWinningMove(t,n);return l||this.findBestStrategicMove(t,e,n)}findWinningMove(t,e){const n=this.getValidMoves(t);for(const i of n)if(this.wouldWin(t,i.row,i.col,e))return i;return null}wouldWin(t,e,n,i){t[e][n]=i;const l=[{dr:0,dc:1},{dr:1,dc:0},{dr:1,dc:1},{dr:1,dc:-1}];let r=!1;for(const{dr:s,dc:a}of l)if(this.countInLine(t,e,n,s,a,i)>=5){r=!0;break}return t[e][n]=null,r}countInLine(t,e,n,i,l,r){let s=1;for(let a=1;a<5;a++){const c=e+i*a,d=n+l*a;if(c<0||c>=this.boardSize||d<0||d>=this.boardSize||t[c][d]!==r)break;s++}for(let a=1;a<5;a++){const c=e-i*a,d=n-l*a;if(c<0||c>=this.boardSize||d<0||d>=this.boardSize||t[c][d]!==r)break;s++}return s}findBestStrategicMove(t,e,n){const i=this.getValidMoves(t);if(i.length===0)return null;if(i.length===this.boardSize*this.boardSize){const s=Math.floor(this.boardSize/2);return{row:s,col:s}}let l=-1/0,r=null;for(const s of i){const a=this.evaluatePosition(t,s.row,s.col,e,n);a>l&&(l=a,r=s)}return r}evaluatePosition(t,e,n,i,l){let r=0;t[e][n]=i,r+=this.evaluatePatterns(t,e,n,i)*1.2,t[e][n]=null,t[e][n]=l,r+=this.evaluatePatterns(t,e,n,l),t[e][n]=null;const s=Math.abs(e-this.boardSize/2)+Math.abs(n-this.boardSize/2);return r+=(this.boardSize-s)*.1,r}evaluatePatterns(t,e,n,i){let l=0;const r=[{dr:0,dc:1},{dr:1,dc:0},{dr:1,dc:1},{dr:1,dc:-1}];for(const{dr:s,dc:a}of r){const c=this.getPattern(t,e,n,s,a,i);l+=this.scorePattern(c)}return l}getPattern(t,e,n,i,l,r){let s="";for(let a=-4;a<=4;a++){const c=e+i*a,d=n+l*a;c<0||c>=this.boardSize||d<0||d>=this.boardSize?s+="X":t[c][d]===r?s+="O":t[c][d]===null?s+="-":s+="X"}return s}scorePattern(t){return t.includes("OOOOO")?1e5:t.includes("-OOOO-")?1e4:t.includes("-OOOO")||t.includes("OOOO-")?1e3:t.includes("-OOO-")?500:t.includes("--OOO-")||t.includes("-OOO--")?400:t.includes("-OOO")||t.includes("OOO-")?100:t.includes("-OO-")?50:t.includes("--OO-")||t.includes("-OO--")?40:t.includes("-OO")||t.includes("OO-")?10:t.includes("-O-")?1:0}getValidMoves(t){const e=[];if(!t.some(r=>r.some(s=>s!==null))){for(let r=0;r<this.boardSize;r++)for(let s=0;s<this.boardSize;s++)e.push({row:r,col:s});return e}const i=new Set,l=2;for(let r=0;r<this.boardSize;r++)for(let s=0;s<this.boardSize;s++)if(t[r][s]!==null)for(let a=-l;a<=l;a++)for(let c=-l;c<=l;c++){const d=r+a,g=s+c;if(d>=0&&d<this.boardSize&&g>=0&&g<this.boardSize&&t[d][g]===null){const m=`${d},${g}`;i.add(m)}}return i.forEach(r=>{const[s,a]=r.split(",").map(Number);e.push({row:s,col:a})}),e}}class B{state="MENU";mode="TWO_PLAYER";boardSize=15;board=[];currentPlayer="BLACK";moves=[];winner=null;winningLine=null;ai;isAIThinking=!1;startTime=null;endTime=null;stateListeners=[];moveListeners=[];boardListeners=[];aiThinkingListeners=[];constructor(){this.ai=new E(this.boardSize),this.initializeBoard()}initializeBoard(){this.board=Array(this.boardSize).fill(null).map(()=>Array(this.boardSize).fill(null))}setBoardSize(t){if(t!==9&&t!==15&&t!==19)throw new Error("Board size must be 9, 15 or 19");this.boardSize=t,this.ai.setBoardSize(t),this.initializeBoard()}getBoardSize(){return this.boardSize}setGameMode(t){this.mode=t}getGameMode(){return this.mode}start(){this.board=[],this.initializeBoard(),this.currentPlayer="BLACK",this.moves=[],this.winner=null,this.winningLine=null,this.startTime=Date.now(),this.endTime=null,this.setState("PLAYING"),this.emitBoard()}makeMove(t,e){if(this.state!=="PLAYING"||this.isAIThinking||t<0||t>=this.boardSize||e<0||e>=this.boardSize||this.board[t][e]!==null||this.mode==="VS_AI"&&this.currentPlayer!=="BLACK")return!1;const n={row:t,col:e,player:this.currentPlayer};return this.board[t][e]=this.currentPlayer,this.moves.push(n),this.emitMove(n),this.checkWin(t,e)?(this.winner=this.currentPlayer,this.endTime=Date.now(),this.setState("RESULT"),!0):this.moves.length===this.boardSize*this.boardSize?(this.endTime=Date.now(),this.setState("RESULT"),!0):(this.currentPlayer=this.currentPlayer==="BLACK"?"WHITE":"BLACK",this.mode==="VS_AI"&&this.currentPlayer==="WHITE"&&this.makeAIMove(),!0)}async makeAIMove(){this.isAIThinking=!0,this.emitAIThinking(!0),setTimeout(()=>{const t=this.ai.getBestMove(this.board,"WHITE");if(t){const e={row:t.row,col:t.col,player:"WHITE"};if(this.board[t.row][t.col]="WHITE",this.moves.push(e),this.emitMove(e),this.checkWin(t.row,t.col)){this.winner="WHITE",this.endTime=Date.now(),this.setState("RESULT"),this.isAIThinking=!1,this.emitAIThinking(!1);return}if(this.moves.length===this.boardSize*this.boardSize){this.endTime=Date.now(),this.setState("RESULT"),this.isAIThinking=!1,this.emitAIThinking(!1);return}this.currentPlayer="BLACK"}this.isAIThinking=!1,this.emitAIThinking(!1)},500)}checkWin(t,e){const n=this.board[t][e];if(!n)return!1;const i=[{dr:0,dc:1},{dr:1,dc:0},{dr:1,dc:1},{dr:1,dc:-1}];for(const{dr:l,dc:r}of i){const s=this.getLine(t,e,l,r,n);if(s.length>=5)return this.winningLine=s,!0}return!1}getLine(t,e,n,i,l){const r=[{row:t,col:e}];for(let s=1;s<5;s++){const a=t+n*s,c=e+i*s;if(a<0||a>=this.boardSize||c<0||c>=this.boardSize||this.board[a][c]!==l)break;r.push({row:a,col:c})}for(let s=1;s<5;s++){const a=t-n*s,c=e-i*s;if(a<0||a>=this.boardSize||c<0||c>=this.boardSize||this.board[a][c]!==l)break;r.unshift({row:a,col:c})}return r}restart(){this.setState("MENU")}setState(t){this.state=t,this.stateListeners.forEach(e=>e(this.state))}getState(){return this.state}getCurrentPlayer(){return this.currentPlayer}getWinner(){return this.winner}getWinningLine(){return this.winningLine}getBoard(){return this.board}getMoves(){return[...this.moves]}isDraw(){return this.state==="RESULT"&&this.winner===null}isAITurn(){return this.mode==="VS_AI"&&this.currentPlayer==="WHITE"}getAIThinking(){return this.isAIThinking}onStateChange(t){this.stateListeners.push(t)}onMove(t){this.moveListeners.push(t)}onBoardChange(t){this.boardListeners.push(t)}onAIThinking(t){this.aiThinkingListeners.push(t)}emitMove(t){this.moveListeners.forEach(e=>e(t))}emitBoard(){this.boardListeners.forEach(t=>t(this.board))}emitAIThinking(t){this.aiThinkingListeners.forEach(e=>e(t))}getElapsedTime(){if(!this.startTime)return 0;const t=this.endTime||Date.now();return Math.floor((t-this.startTime)/1e3)}formatTime(t){const e=Math.floor(t/60),n=t%60;return`${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}}const u=new B,k={ui:{gameTitle:"Gomoku",gameSetup:"Game Setup",gameMode:"Game Mode",twoPlayers:"2 Players",vsAI:"vs AI",comingSoon:"Coming Soon",boardSize:"Board Size",startGame:"Start Game",newGame:"New Game",blackTurn:"Black's Turn",whiteTurn:"White's Turn",yourTurn:"Your Turn",aiTurn:"AI's Turn",aiThinking:"AI is thinking...",move:"Move",gameOver:"Game Over!",blackWins:"Black Wins!",whiteWins:"White Wins!",blackPlayerWins:"Black Player Wins!",whitePlayerWins:"White Player Wins!",youWin:"You Win!",aiWins:"AI Wins!",draw:"It's a Draw!",boardFull:"The board is full. It's a draw!",totalMoves:"Total Moves",totalTime:"Total Time",playAgain:"Play Again",highScores:"High Scores",rank:"Rank",moves:"Moves",time:"Time",date:"Date"}},C={ui:{gameTitle:"五目並べ",gameSetup:"ゲーム設定",gameMode:"ゲームモード",twoPlayers:"2プレイヤー",vsAI:"vsCPU",comingSoon:"近日公開",boardSize:"盤面サイズ",startGame:"ゲーム開始",newGame:"新規ゲーム",blackTurn:"黒の番",whiteTurn:"白の番",yourTurn:"あなたの番",aiTurn:"CPUの番",aiThinking:"CPUが考え中...",move:"手数",gameOver:"ゲーム終了！",blackWins:"黒の勝ち！",whiteWins:"白の勝ち！",blackPlayerWins:"黒プレイヤーの勝利！",whitePlayerWins:"白プレイヤーの勝利！",youWin:"あなたの勝ち！",aiWins:"CPUの勝ち！",draw:"引き分け！",boardFull:"盤面が埋まりました。引き分けです！",totalMoves:"合計手数",totalTime:"合計時間",playAgain:"もう一度プレイ",highScores:"ハイスコア",rank:"順位",moves:"手数",time:"時間",date:"日付"}},M={ui:{gameTitle:"Cờ Ca-rô",gameSetup:"Thiết Lập Trò Chơi",gameMode:"Chế Độ Chơi",twoPlayers:"2 Người Chơi",vsAI:"vs Máy",comingSoon:"Sắp Ra Mắt",boardSize:"Kích Thước Bàn",startGame:"Bắt Đầu",newGame:"Ván Mới",blackTurn:"Lượt Đen",whiteTurn:"Lượt Trắng",yourTurn:"Lượt Của Bạn",aiTurn:"Lượt Của Máy",aiThinking:"Máy đang suy nghĩ...",move:"Nước",gameOver:"Kết Thúc!",blackWins:"Đen Thắng!",whiteWins:"Trắng Thắng!",blackPlayerWins:"Người Chơi Đen Thắng!",whitePlayerWins:"Người Chơi Trắng Thắng!",youWin:"Bạn Thắng!",aiWins:"Máy Thắng!",draw:"Hòa!",boardFull:"Bàn cờ đã đầy. Trận đấu hòa!",totalMoves:"Tổng Số Nước",totalTime:"Tổng Thời Gian",playAgain:"Chơi Lại",highScores:"Bảng Xếp Hạng",rank:"Hạng",moves:"Số Nước",time:"Thời Gian",date:"Ngày"}},z={en:k,ja:C,vi:M};class x{currentLang="en";listeners=[];constructor(t="en"){this.currentLang=t}get language(){return this.currentLang}setLanguage(t){this.currentLang!==t&&(this.currentLang=t,localStorage.setItem("anguage",t),this.notifyListeners())}subscribe(t){this.listeners.push(t)}notifyListeners(){this.listeners.forEach(t=>t(this.currentLang))}getUIText(t){return z[this.currentLang].ui[t]||t}}const O=localStorage.getItem("language"),h=new x(O||"en");class W{dialog;STORAGE_KEY="consentMode";constructor(){this.dialog=document.createElement("div"),this.dialog.className="consent-dialog",this.dialog.innerHTML=`
            <div class="consent-content">
                <h3>We value your privacy</h3>
                <p>We use cookies to improve your experience, analyze traffic, and show relevant ads.</p>
                <p>You can choose to accept or reject these cookies.</p>
                <p>Essential cookies are always on because they are required for the site to work.</p>
                <div class="consent-buttons">
                    <button id="btn-reject" class="btn-reject">Reject All</button>
                    <button id="btn-accept" class="btn-accept">Accept All</button>
                </div>
            </div>
        `,document.body.appendChild(this.dialog),this.init()}init(){const t=localStorage.getItem(this.STORAGE_KEY);t?this.updateConsent(t==="granted"):this.showDialog(),this.dialog.querySelector("#btn-accept")?.addEventListener("click",()=>{this.setConsent(!0)}),this.dialog.querySelector("#btn-reject")?.addEventListener("click",()=>{this.setConsent(!1)})}showDialog(){this.dialog.style.display="flex"}hideDialog(){this.dialog.style.display="none"}setConsent(t){localStorage.setItem(this.STORAGE_KEY,t?"granted":"denied"),this.updateConsent(t),this.hideDialog()}updateConsent(t){const e=t?"granted":"denied";typeof window.gtag=="function"&&window.gtag("consent","update",{ad_storage:e,ad_user_data:e,ad_personalization:e,analytics_storage:e})}}new W;const P=document.querySelector("#app"),G=()=>{P.innerHTML=`
    <div class="header-controls">
      <button id="home-btn" class="icon-btn" aria-label="Back to Home">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
      </button>
      <h1 id="game-title">Gomoku</h1>
    </div>
    
    <!-- Language Switcher -->
    <div class="lang-switcher">
      <button class="lang-btn active" data-lang="en">EN</button>
      <button class="lang-btn" data-lang="ja">JA</button>
      <button class="lang-btn" data-lang="vi">VI</button>
    </div>
    
    <!-- Menu View -->
    <div id="menu-view" class="card animate-fade-in">
      <h2 id="menu-title">Game Setup</h2>
      <div class="menu-options">
        <div class="option-group">
          <label id="label-mode">Game Mode</label>
          <div class="mode-selector">
            <button id="mode-two-player" class="mode-btn active" data-mode="TWO_PLAYER">2 Players</button>
            <button id="mode-vs-ai" class="mode-btn" data-mode="VS_AI">vs AI</button>
          </div>
        </div>

        <div class="option-group">
          <label id="label-board-size">Board Size</label>
          <div class="size-selector">
            <button class="size-btn" data-size="9">9 × 9</button>
            <button class="size-btn active" data-size="15">15 × 15</button>
            <button class="size-btn" data-size="19">19 × 19</button>
          </div>
        </div>

        <button id="start-btn" class="primary">Start Game</button>
      </div>
    </div>

    <!-- Game View -->
    <div id="game-view" class="card hidden animate-fade-in">
      <button id="new-game-btn" class="primary">New Game</button>
      <div class="game-info">
        <div class="current-turn">
          <div class="turn-indicator black"></div>
          <span id="turn-text">Black's Turn</span>
        </div>
        <div class="move-count">
          <span id="label-move">Move</span>: <span id="move-number">0</span>
        </div>
        <div class="game-timer">
          <span id="label-time">Time</span>: <span id="game-timer">00:00</span>
        </div>
      </div>
      
      <div id="board-container">
        <svg id="board" viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">
          <!-- Board will be rendered here -->
        </svg>
      </div>
    </div>

    <!-- Result View -->
    <div id="result-view" class="card hidden animate-fade-in">
      <h2 id="result-title">Game Over!</h2>
      
      <div class="winner-display" id="winner-display">
        <!-- Winner info will be injected here -->
      </div>

      <div class="game-stats">
        <div class="stat">
          <div class="stat-label" id="label-total-moves">Total Moves</div>
          <div class="stat-value" id="total-moves">0</div>
        </div>
        <div class="stat">
            <div class="stat-label" id="label-total-time">Total Time</div>
            <div class="stat-value" id="total-time">00:00</div>
        </div>
      </div>

      <!-- High Scores Table -->
      <div class="high-scores-container">
        <h3 id="high-scores-title">High Scores (vs AI)</h3>
        <table id="high-scores-table">
          <thead>
            <tr>
              <th id="th-rank">Rank</th>
              <th id="th-moves">Moves</th>
              <th id="th-time">Time</th>
              <th id="th-date">Date</th>
            </tr>
          </thead>
          <tbody id="high-scores-body">
            <!-- Scores injected here -->
          </tbody>
        </table>
      </div>

      <button id="restart-btn" class="primary">Play Again</button>
    </div>
  `,H(),A(),document.querySelectorAll(".lang-btn").forEach(o=>{o.classList.toggle("active",o.dataset.lang===h.language)}),U()},N=()=>{const o=document.querySelector(".mode-btn.active"),t=document.querySelector(".size-btn.active");if(o&&t){const e={mode:o.dataset.mode,size:t.dataset.size};localStorage.setItem("gomokuSetup",JSON.stringify(e))}},U=()=>{try{const o=localStorage.getItem("gomokuSetup");if(o){const{mode:t,size:e}=JSON.parse(o);t&&document.querySelectorAll(".mode-btn").forEach(n=>{n.dataset.mode===t?(n.classList.add("active"),u.setGameMode(t)):n.classList.remove("active")}),e&&document.querySelectorAll(".size-btn").forEach(n=>{n.dataset.size===e?(n.classList.add("active"),u.setBoardSize(parseInt(e))):n.classList.remove("active")})}}catch(o){console.error("Failed to load Gomoku setup:",o)}},A=()=>{const o=document.getElementById("game-title");o&&(o.textContent=h.getUIText("gameTitle"));const t=document.getElementById("menu-title");t&&(t.textContent=h.getUIText("gameSetup"));const e=document.getElementById("label-mode");e&&(e.textContent=h.getUIText("gameMode"));const n=document.getElementById("mode-two-player");n&&(n.textContent=h.getUIText("twoPlayers"));const i=document.getElementById("mode-vs-ai");i&&(i.textContent=h.getUIText("vsAI"),i.classList.contains("disabled")&&(i.innerHTML=`${h.getUIText("vsAI")}<br><span style="font-size: 0.7rem; opacity: 0.7;">(${h.getUIText("comingSoon")})</span>`));const l=document.getElementById("label-board-size");l&&(l.textContent=h.getUIText("boardSize"));const r=document.getElementById("start-btn");r&&(r.textContent=h.getUIText("startGame"));const s=document.getElementById("label-move");s&&(s.textContent=h.getUIText("move"));const a=document.getElementById("new-game-btn");a&&(a.textContent=h.getUIText("newGame")),T();const c=document.getElementById("label-total-moves");c&&(c.textContent=h.getUIText("totalMoves"));const d=document.getElementById("restart-btn");d&&(d.textContent=h.getUIText("playAgain"));const g=document.getElementById("label-time");g&&(g.textContent=h.getUIText("time"));const m=document.getElementById("label-total-time");m&&(m.textContent=h.getUIText("totalTime"));const v=document.getElementById("high-scores-title");v&&(v.textContent=h.getUIText("highScores"));const f=document.getElementById("th-rank");f&&(f.textContent=h.getUIText("rank"));const p=document.getElementById("th-moves");p&&(p.textContent=h.getUIText("moves"));const b=document.getElementById("th-time");b&&(b.textContent=h.getUIText("time"));const S=document.getElementById("th-date");S&&(S.textContent=h.getUIText("date"))},H=()=>{document.getElementById("home-btn")?.addEventListener("click",()=>{window.location.href="/"}),document.querySelectorAll(".lang-btn").forEach(o=>{o.addEventListener("click",t=>{const e=t.target.dataset.lang;h.setLanguage(e),document.querySelectorAll(".lang-btn").forEach(n=>n.classList.remove("active")),t.target.classList.add("active")})}),document.querySelectorAll(".mode-btn:not(.disabled)").forEach(o=>{o.addEventListener("click",t=>{const e=t.target,n=e.dataset.mode;document.querySelectorAll(".mode-btn").forEach(i=>i.classList.remove("active")),e.classList.add("active"),u.setGameMode(n)})}),document.querySelectorAll(".size-btn").forEach(o=>{o.addEventListener("click",t=>{const e=t.target,n=parseInt(e.dataset.size||"15");document.querySelectorAll(".size-btn").forEach(i=>i.classList.remove("active")),e.classList.add("active"),u.setBoardSize(n)})}),document.getElementById("start-btn")?.addEventListener("click",()=>{N(),u.start()}),document.getElementById("new-game-btn")?.addEventListener("click",()=>{u.restart()}),document.getElementById("restart-btn")?.addEventListener("click",()=>{u.restart()})},R=()=>{const o=document.getElementById("board");if(!o)return;o.innerHTML="";const t=u.getBoardSize(),e=30,i=(600-2*e)/(t-1),l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("width","600"),l.setAttribute("height","600"),l.setAttribute("fill","#2d3748"),l.setAttribute("rx","8"),o.appendChild(l);const r=document.createElementNS("http://www.w3.org/2000/svg","g");r.setAttribute("stroke","#4a5568"),r.setAttribute("stroke-width","1.5");for(let d=0;d<t;d++){const g=e+d*i,m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",e.toString()),m.setAttribute("y1",g.toString()),m.setAttribute("x2",(600-e).toString()),m.setAttribute("y2",g.toString()),r.appendChild(m);const v=document.createElementNS("http://www.w3.org/2000/svg","line");v.setAttribute("x1",g.toString()),v.setAttribute("y1",e.toString()),v.setAttribute("x2",g.toString()),v.setAttribute("y2",(600-e).toString()),r.appendChild(v)}o.appendChild(r);let s=[];t===9?s=[[2,2],[2,6],[4,4],[6,2],[6,6]]:t===15?s=[[3,3],[3,11],[7,7],[11,3],[11,11]]:s=[[3,3],[3,9],[3,15],[9,3],[9,9],[9,15],[15,3],[15,9],[15,15]],s.forEach(([d,g])=>{const m=document.createElementNS("http://www.w3.org/2000/svg","circle");m.setAttribute("cx",(e+g*i).toString()),m.setAttribute("cy",(e+d*i).toString()),m.setAttribute("r","4"),m.setAttribute("fill","#4a5568"),o.appendChild(m)});const a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("id","stones-group"),o.appendChild(a),o.style.cursor="crosshair",o.addEventListener("click",d=>{if(u.getState()!=="PLAYING")return;const g=o.getBoundingClientRect(),m=d.clientX-g.left,v=d.clientY-g.top,f=m/g.width*600,p=v/g.height*600,b=Math.round((f-e)/i),S=Math.round((p-e)/i);S>=0&&S<t&&b>=0&&b<t&&u.makeMove(S,b)});const c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("r",(i*.4).toString()),c.setAttribute("fill","none"),c.setAttribute("stroke","#8ab4f8"),c.setAttribute("stroke-width","2"),c.setAttribute("opacity","0"),c.setAttribute("pointer-events","none"),o.appendChild(c),o.addEventListener("mousemove",d=>{if(u.getState()!=="PLAYING"){c.setAttribute("opacity","0");return}const g=o.getBoundingClientRect(),m=d.clientX-g.left,v=d.clientY-g.top,f=m/g.width*600,p=v/g.height*600,b=Math.round((f-e)/i),S=Math.round((p-e)/i);S>=0&&S<t&&b>=0&&b<t&&u.getBoard()[S][b]===null?(c.setAttribute("cx",(e+b*i).toString()),c.setAttribute("cy",(e+S*i).toString()),c.setAttribute("opacity","0.6")):c.setAttribute("opacity","0")}),o.addEventListener("mouseleave",()=>{c.setAttribute("opacity","0")})},D=o=>{const t=document.getElementById("board"),e=document.getElementById("stones-group");if(!t||!e)return;const n=u.getBoardSize(),i=30,r=(600-2*i)/(n-1),s=r*.42,a=i+o.col*r,c=i+o.row*r,d=document.createElementNS("http://www.w3.org/2000/svg","ellipse");d.setAttribute("cx",(a+2).toString()),d.setAttribute("cy",(c+2).toString()),d.setAttribute("rx",s.toString()),d.setAttribute("ry",(s*.9).toString()),d.setAttribute("fill","rgba(0, 0, 0, 0.3)"),d.classList.add("stone-animate"),e.appendChild(d);const g=`grad-${o.player}-${o.row}-${o.col}`,m=document.createElementNS("http://www.w3.org/2000/svg","defs"),v=document.createElementNS("http://www.w3.org/2000/svg","radialGradient");if(v.setAttribute("id",g),v.setAttribute("cx","30%"),v.setAttribute("cy","30%"),o.player==="BLACK"){const p=document.createElementNS("http://www.w3.org/2000/svg","stop");p.setAttribute("offset","0%"),p.setAttribute("stop-color","#4a5568");const b=document.createElementNS("http://www.w3.org/2000/svg","stop");b.setAttribute("offset","100%"),b.setAttribute("stop-color","#1a202c"),v.appendChild(p),v.appendChild(b)}else{const p=document.createElementNS("http://www.w3.org/2000/svg","stop");p.setAttribute("offset","0%"),p.setAttribute("stop-color","#ffffff");const b=document.createElementNS("http://www.w3.org/2000/svg","stop");b.setAttribute("offset","100%"),b.setAttribute("stop-color","#f7fafc"),v.appendChild(p),v.appendChild(b)}m.appendChild(v),t.appendChild(m);const f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("cx",a.toString()),f.setAttribute("cy",c.toString()),f.setAttribute("r",s.toString()),f.setAttribute("fill",`url(#${g})`),f.setAttribute("stroke",o.player==="BLACK"?"#0d131a":"#e2e8f0"),f.setAttribute("stroke-width","2"),f.classList.add("stone-animate"),e.appendChild(f)},T=()=>{const o=document.querySelector(".turn-indicator"),t=document.getElementById("turn-text"),e=document.getElementById("move-number"),n=u.getCurrentPlayer(),i=u.getMoves();o&&(o.className=`turn-indicator ${n.toLowerCase()}`),t&&(t.textContent=n==="BLACK"?h.getUIText("blackTurn"):h.getUIText("whiteTurn")),e&&(e.textContent=i.length.toString())},y=o=>{["menu-view","game-view","result-view"].forEach(t=>{const e=document.getElementById(t);e&&(t===o?e.classList.remove("hidden"):e.classList.add("hidden"))})};let w=null,I="MENU";u.onStateChange(o=>{I=o,o==="MENU"&&(y("menu-view"),w&&(clearInterval(w),w=null)),o==="PLAYING"&&(y("game-view"),R(),T(),w&&clearInterval(w),w=window.setInterval(()=>{const t=u.getElapsedTime(),e=u.formatTime(t),n=document.getElementById("game-timer");n&&(n.textContent=e)},1e3)),o==="RESULT"&&(y("result-view"),w&&(clearInterval(w),w=null),K(),L())});u.onMove(o=>{D(o),T()});const K=()=>{if(u.getGameMode()!=="VS_AI"||u.getWinner()!=="BLACK")return;const o=u.getMoves().length,t=u.getElapsedTime(),e=Date.now(),n=u.getBoardSize(),i={moves:o,time:t,date:e,boardSize:n},l="gomoku_highscores";try{const r=localStorage.getItem(l);let s=r?JSON.parse(r):[];s.push(i),s.sort((a,c)=>a.moves!==c.moves?a.moves-c.moves:a.time-c.time),s=s.slice(0,5),localStorage.setItem(l,JSON.stringify(s))}catch(r){console.error("Failed to save high score:",r)}},q=()=>{const o="gomoku_highscores";try{const t=localStorage.getItem(o);return t?JSON.parse(t):[]}catch{return[]}},L=()=>{const o=u.getWinner(),t=document.getElementById("winner-display"),e=document.getElementById("total-moves"),n=document.getElementById("total-time"),i=document.getElementById("result-title");if(e&&(e.textContent=u.getMoves().length.toString()),n&&(n.textContent=u.formatTime(u.getElapsedTime())),o){if(i&&(i.textContent=o==="BLACK"?h.getUIText("blackWins"):h.getUIText("whiteWins")),t){const a=o==="BLACK"?h.getUIText("blackPlayerWins"):h.getUIText("whitePlayerWins");t.innerHTML=`
        <div class="winner-stone ${o.toLowerCase()}"></div>
        <span>${a}</span>
      `}}else i&&(i.textContent=h.getUIText("draw")),t&&(t.innerHTML=`<span>${h.getUIText("boardFull")}</span>`);const l=q(),r=document.getElementById("high-scores-body"),s=document.querySelector(".high-scores-container");u.getGameMode()==="VS_AI"?(s&&s.classList.remove("hidden"),r&&(r.innerHTML="",l.forEach((a,c)=>{const d=document.createElement("tr"),g=u.getMoves().length,m=u.getElapsedTime();u.getWinner()==="BLACK"&&a.moves===g&&a.time===m&&typeof a.date=="number"&&Date.now()-a.date<1e3&&d.classList.add("current-run");let v="";if(typeof a.date=="number"){const p=h.language==="vi"?"vi-VN":"en-US";v=new Date(a.date).toLocaleDateString(p)}else v=a.date;d.innerHTML=`
                    <td>${c+1}</td>
                    <td>${a.moves}</td>
                    <td>${u.formatTime(a.time)}</td>
                    <td>${v}</td>
                `,r.appendChild(d)}))):s&&s.classList.add("hidden")};h.subscribe(()=>{A(),I==="RESULT"&&L()});G();</script>
  <style rel="stylesheet" crossorigin>@import"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap";:root{--bg-primary: #0f1419;--bg-secondary: #1a1f29;--bg-card: #1e2633;--text-primary: #e8eaed;--text-secondary: #9aa0a6;--accent-primary: #8ab4f8;--accent-secondary: #f28b82;--board-bg: #2d3748;--board-line: #4a5568;--stone-black: #1a202c;--stone-white: #f7fafc;--shadow-sm: 0 2px 4px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .4);--shadow-lg: 0 10px 25px rgba(0, 0, 0, .5);--shadow-glow: 0 0 20px rgba(138, 180, 248, .3)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;background:linear-gradient(135deg,var(--bg-primary) 0%,var(--bg-secondary) 100%);color:var(--text-primary);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem}#app{width:100%;max-width:900px;margin:0 auto}h1{text-align:center;font-size:3rem;font-weight:700;margin-bottom:0;background:linear-gradient(135deg,var(--accent-primary),var(--accent-secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:var(--shadow-sm)}.header-controls{display:flex;align-items:center;justify-content:center;gap:1rem;margin-bottom:2rem;position:relative}.icon-btn{background:transparent;border:none;color:var(--text-secondary);cursor:pointer;padding:.5rem;border-radius:50%;transition:all .2s ease;display:flex;align-items:center;justify-content:center;width:64px;height:64px;position:absolute;left:0}.icon-btn:hover{background:var(--bg-secondary);color:var(--accent-primary);transform:translateY(-2px)}.lang-switcher{display:flex;justify-content:center;gap:.5rem;margin-bottom:2rem}.lang-btn{padding:.5rem 1rem;font-size:.875rem;font-weight:600;border:2px solid var(--board-line);background:var(--bg-secondary);color:var(--text-secondary);border-radius:.375rem;cursor:pointer;transition:all .2s ease;min-width:3rem}.lang-btn:hover{border-color:var(--accent-primary)}.lang-btn.active{background:var(--accent-primary);border-color:var(--accent-primary);color:#fff}.card{background:var(--bg-card);border-radius:1rem;padding:2rem;box-shadow:var(--shadow-lg);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);transition:all .3s ease}.hidden{display:none!important}#menu-view h2{font-size:2rem;margin-bottom:2rem;text-align:center;color:var(--text-primary)}.menu-options{display:flex;flex-direction:column;gap:1.5rem}.option-group{display:flex;flex-direction:column;gap:.75rem}.option-group label{font-size:.9rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.05em}.mode-selector,.size-selector{display:flex;gap:1rem}.mode-btn,.size-btn{flex:1;padding:1rem;font-size:1rem;font-weight:600;border:2px solid var(--board-line);background:var(--bg-secondary);color:var(--text-primary);border-radius:.5rem;cursor:pointer;transition:all .2s ease}.mode-btn:hover,.size-btn:hover{border-color:var(--accent-primary);transform:translateY(-2px);box-shadow:var(--shadow-md)}.mode-btn.active,.size-btn.active{background:linear-gradient(135deg,var(--accent-primary),var(--accent-secondary));border-color:transparent;color:#fff;box-shadow:var(--shadow-glow)}.mode-btn.disabled,.size-btn.disabled{opacity:.5;cursor:not-allowed}button.primary{width:100%;padding:1rem 2rem;font-size:1.1rem;font-weight:700;background:linear-gradient(135deg,var(--accent-primary),var(--accent-secondary));color:#fff;border:none;border-radius:.5rem;cursor:pointer;transition:all .3s ease;box-shadow:var(--shadow-md);margin-top:1rem}button.primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-glow)}button.primary:active{transform:translateY(0)}#game-view{display:flex;flex-direction:column;align-items:center;gap:1.5rem}#result-view{text-align:center}#result-view h2{font-size:2.5rem;margin-bottom:1.5rem;background:linear-gradient(135deg,var(--accent-primary),var(--accent-secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.winner-display{display:flex;align-items:center;justify-content:center;gap:1rem;margin:2rem 0;font-size:1.5rem;font-weight:600}.winner-stone{width:48px;height:48px;border-radius:50%;box-shadow:var(--shadow-md);border:3px solid var(--board-line)}.winner-stone.black{background:radial-gradient(circle at 30% 30%,#4a5568,var(--stone-black))}.winner-stone.white{background:radial-gradient(circle at 30% 30%,white,var(--stone-white))}.game-stats{display:flex;justify-content:center;gap:2rem;margin:2rem 0;padding:1.5rem;background:var(--bg-secondary);border-radius:.5rem}.stat{display:flex;flex-direction:column;align-items:center;gap:.5rem}.stat-label{font-size:.85rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.05em}.stat-value{font-size:1.5rem;font-weight:700;color:var(--accent-primary)}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes stonePlaced{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2)}to{transform:scale(1);opacity:1}}@keyframes pulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}.animate-fade-in{animation:fadeIn .3s ease}.stone-animate{animation:stonePlaced .3s cubic-bezier(.34,1.56,.64,1)}@media(max-width:768px){h1{font-size:2rem}.card{padding:1.5rem}#board-container{max-width:400px}.game-info{flex-direction:column;gap:.75rem}.mode-selector,.size-selector,.lang-switcher{flex-direction:column}}.game-info{width:100%;display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--bg-secondary);border-radius:.5rem;border:1px solid rgba(255,255,255,.05)}.current-turn{font-size:1.2rem;font-weight:600;display:flex;align-items:center;gap:.75rem}.turn-indicator{width:24px;height:24px;border-radius:50%;border:2px solid var(--board-line);box-shadow:var(--shadow-sm);transition:all .3s ease;animation:pulse 2s ease-in-out infinite}.turn-indicator.black{background:var(--stone-black)}.turn-indicator.white{background:var(--stone-white)}.move-count{font-size:.9rem;color:var(--text-secondary)}#board-container{position:relative;width:100%;max-width:600px;aspect-ratio:1}#board{width:100%;height:100%;display:block;cursor:crosshair;filter:drop-shadow(var(--shadow-md))}.consent-dialog{position:fixed;inset:0;background:#000000bf;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);z-index:10000;display:none;align-items:center;justify-content:center;padding:1rem;animation:fadeIn .3s ease}.consent-content{background:var(--bg-card);border-radius:1rem;padding:2rem;max-width:500px;width:100%;box-shadow:var(--shadow-lg);border:1px solid rgba(255,255,255,.1);animation:slideUp .3s ease}.consent-content h3{margin:0 0 1rem;font-size:1.5rem;color:var(--text-primary)}.consent-content p{margin:0 0 1.5rem;color:var(--text-secondary);line-height:1.6}.consent-buttons{display:flex;gap:.75rem;flex-wrap:wrap}.btn-accept,.btn-reject{flex:1;min-width:120px;padding:.875rem 1.5rem;border-radius:.5rem;font-weight:600;font-size:1rem;cursor:pointer;transition:all .2s ease;border:none}.btn-accept{background:var(--accent-primary);color:#fff}.btn-accept:hover{background:var(--accent-secondary);transform:translateY(-2px);box-shadow:var(--shadow-md)}.btn-reject{background:transparent;border:2px solid var(--text-secondary);color:var(--text-secondary)}.btn-reject:hover{border-color:var(--text-primary);color:var(--text-primary);background:#ffffff0d}@keyframes slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media(max-width:640px){.consent-content{padding:1.5rem}.consent-buttons{flex-direction:column}.btn-accept,.btn-reject{width:100%}}.high-scores-container{width:100%;margin-top:2rem;animation:fadeIn .5s ease}#high-scores-title{font-size:1.5rem;margin-bottom:1rem;color:var(--text-primary);text-align:center}#high-scores-table{width:100%;border-collapse:collapse;background:#0003;border-radius:.5rem;overflow:hidden}#high-scores-table th,#high-scores-table td{padding:1rem;text-align:center;border-bottom:1px solid rgba(255,255,255,.05)}#high-scores-table th{background:#ffffff0d;color:var(--text-secondary);font-weight:600;text-transform:uppercase;font-size:.85rem;letter-spacing:.05em}#high-scores-table td{color:var(--text-primary);font-size:1rem}#high-scores-table tr:last-child td{border-bottom:none}#high-scores-table tr.current-run{background:#8ab4f81a;border-left:3px solid var(--accent-primary)}#high-scores-table tr.current-run td{color:var(--accent-primary);font-weight:600}</style>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-56G5F5W4" height="0" width="0"
            style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div id="app"></div>

</body>

</html>